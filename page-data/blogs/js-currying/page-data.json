{"componentChunkName":"component---src-templates-blog-post-js","path":"/blogs/js-currying/","result":{"data":{"site":{"siteMetadata":{"title":"Chenxiao's Blog","author":"Chenxiao Guan"}},"markdownRemark":{"id":"9acf0e74-40de-5490-8b71-b9e2a858e304","excerpt":"…","html":"<p>今天刚刚参加了字节跳动前端校招的第一轮面试，被问到了一道这样的题目：</p>\n<div class=\"gatsby-highlight\" data-language=\"md\"><pre class=\"language-md\"><code class=\"language-md\">实现一个 add 函数，要求同一个函数能够实现两种调用的方法：\nadd(1, 2, 3, 4); // 10\nadd(1)(2)(3)(4); // 10</code></pre></div>\n<p>首先我们简化一下这个问题：如果函数只有两个以下的参数，我们要如何实现？</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> y <span class=\"token operator\">!==</span> <span class=\"token string\">\"undefined\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> x <span class=\"token operator\">+</span> y<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> x <span class=\"token operator\">+</span> y<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>如果是不一定多少个参数传进来的话，首先我们是一定要用到<code class=\"language-text\">arguments</code>这个变量的。\n其次，我们需要运用到闭包的概念将最终结果保存在一个闭包值内。但是如果保存在闭包值内的话，我们就无法返回这个值的同时返回函数本身实现柯里化。所以我们可以运用到重定义函数<code class=\"language-text\">toString</code>这个方法，将<code class=\"language-text\">toString</code>的返回值设置为我们闭包内存储的和，这样就实现了我们无限柯里化。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">curriedAdd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> <span class=\"token let\">_sum</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> <span class=\"token let\">i</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> arguments<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    _sum <span class=\"token operator\">+=</span> arguments<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">curried</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> <span class=\"token let\">i</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> arguments<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      _sum <span class=\"token operator\">+=</span> arguments<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> curried<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  curried<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">toString</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> _sum<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> curried<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">curriedAdd</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 15</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">curriedAdd</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 36</span></code></pre></div>\n<p>这里除了柯里化的实现以外还有一个小的知识点可以记住：\nConsole 的 API 是没有一个统一实现标准的。在有些浏览器中，<code class=\"language-text\">console.log</code>如果传进的是一个对象，那么会自动对这个对象执行<code class=\"language-text\">toString()</code>。以上实现柯里化的方法就依赖于这一点。\n但是，不是所有的浏览器（或者说 JS 运行时）都是这样实现<code class=\"language-text\">console.log</code>的。比如 NodeJS 就不会对对象执行<code class=\"language-text\">toString()</code>：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 398px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6a8eaf5a2384cbdf74b6bf19c8f18135/692d4/node.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.756756756756756%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsSAAALEgHS3X78AAAAUElEQVQI1x2KXQqAIBAGO5SKRNAfSLnWGhllEd3/FF9bDwMzMIWfD3xQzKj7gNYxPGeM046q8QjL9fdACdpFGGnDJ5S4lsemB3a9oWhD2RFe4rsleKuWG7MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"nodejs\"\n        title=\"nodejs\"\n        src=\"/static/6a8eaf5a2384cbdf74b6bf19c8f18135/692d4/node.png\"\n        srcset=\"/static/6a8eaf5a2384cbdf74b6bf19c8f18135/12f09/node.png 148w,\n/static/6a8eaf5a2384cbdf74b6bf19c8f18135/e4a3f/node.png 295w,\n/static/6a8eaf5a2384cbdf74b6bf19c8f18135/692d4/node.png 398w\"\n        sizes=\"(max-width: 398px) 100vw, 398px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>上述代码中的两个<code class=\"language-text\">console.log</code>取而代之的是会返回如上图中的结果，也就是两个描述函数对象的字符串，而并不是<code class=\"language-text\">toString()</code>返回的结果。\n这次面试的时候就是被这一点坑了很久。以为自己实现错了，其实只是 NodeJS 不会隐式的对对象执行<code class=\"language-text\">toString</code>而已。</p>","frontmatter":{"title":"如何在JS中柯里化(curry)一个函数","date":"August 29, 2020","description":"JS的语言基础之一，涉及到闭包，函数编程等知识。"}}},"pageContext":{"slug":"/js-currying/","previous":{"fields":{"slug":"/debounce-throttle/"},"frontmatter":{"title":"JS中防抖(debounce)与节流(throttle)的实现方式"}},"next":null}}}